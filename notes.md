# Introduction

Not a real README, but we're testing the application and want to document it, so started taking notes here to create the real README.

# Application structure

- HOCR2ALTO: Scripts to convert between these formats. Can leave them in public repo (maybe remove most of the outputs and leave one as an example?)
- ncrf: Andrew's neural CRF tests. Can remove it since didn't really exploit it
- sklearn_crfsuite: This is the main program. Most things happen here.
- utils.py: Useful to keep these in the public application
- example: some models, inputs and outputs for us to test and document things. Might leave something like this in the public repo

# Prediction

To generate TEI based on a directory of HOCR files, use the following command from within the `sklearn_crfsuite` directory:

```python main.py MODEL_PATH HOCR_DIRECTORY OUTPUT_TEI_PATH```

For instance:

```python main.py ../example/models/model-exp3-20221226.crf ../example/inputs/hocr-verbotte-fahne ../example/outputs/verbotte-fahne-exp3.xml```

This will predict the `../example/outputs/verbotte-fahne-exp3.xml` TEI file based on HOCR at `../example/inputs/hocr-verbotte-fahne`

# Training

Training data consist on HOCR files and manually corrected TEI for them.

At the moment the training corpus is located at pre-defined directories inside `sklearn_crfsuite`:

- `html`: The HOCR (from which the features are computed)
- `tei`: The TEI (the labels to predict)

To train a model, use the following command from within `sklearn_crfsuite`:

```
python train.py html tei MODEL_OUTPUT_PATH
```

```
python train.py html tei ../example/models/model-exp3-new.crf
```

The `exp3` infix in the model filename was used for the follwoing reason: Several feature combinations were implemented in the tool. The best one was called `exp3` and this model was trained with it, so we chose to include `exp3` in the filename (output-file naming is manual)

# Postprocessing

Let's show this with an example. If you trained a model using the example command above and use it to predict a TEI for `../example/input/hocr-verbotte-fahne`, your results should reproduce `../example/outputs/verbotte-fahne-exp3.xml`.

The prediction doesn't look bad, but you'll see it is not valid XML. This is because the model is designed to handle the plays' body, from the start of the first act to the final curtain, but not the front matter and back matter that may precede and follow those. Since we did not remove HOCR files for the front matter and back matter, the model tried to generate TEI from them, but this was expected to give errors. Once the portions generated based on the front matter and back matter are removed, the file will be valid XML. You can compare the file before and after by comparing `../example/outputs/verbotte-fahne-exp3.xml` with `../example/outputs/verbotte-fahne-exp3-postpro.xml`

\#TODO: not crucial since we postprocess the basic XML generated by the model in several ways and manually correct errors, but we could acutally add the TEI schema reference to the generated XML, to see if it already validates against the TEI schema even just after removing front/backmatter

\#TODO: change in main.py the CSS reference so that it points to ../example/css, that way ppl can read the examples with the CSS
